<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>–ê—Ä–∞–±—Å–∫–∏–µ –¢—Ä–µ–Ω–∞–∂–µ—Ä—ã</title>
    <script src="theme.js"></script>
    <script>
      // –í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –µ—Å—Ç—å (–∫—Ä–æ–º–µ —Å–ª—É—á–∞—è ?home=1)
      (function() {
        const urlParams = new URLSearchParams(location.search);
        const stayOnHome = urlParams.has('home');
        if (!stayOnHome) {
          const lastPage = localStorage.getItem('arabLastPage');
          if (lastPage && lastPage !== 'index.html') {
            window.location.replace(lastPage);
          }
        }
      })();
    </script>
    <link rel="stylesheet" href="theme.css">
    <script src="service-worker-register.js"></script>
    <script src="dua.js"></script>
    <script src="streak.js"></script>
    
    <!-- Firebase –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ streak –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
    (async function initFirebaseForStreak() {
        try {
            const firebaseConfig = {
                apiKey: "AIzaSyC2yC_BlLuP3dEzWUlWe57hhI4CezNZCy0",
                authDomain: "arab-learning-hub.firebaseapp.com",
                projectId: "arab-learning-hub",
                storageBucket: "arab-learning-hub.firebasestorage.app",
                messagingSenderId: "377334822830",
                appId: "1:377334822830:web:7cb045a81824741f427a3f"
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Firebase –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            const db = firebase.firestore();
            db.settings({
                experimentalForceLongPolling: true,
                useFetchStreams: false
            });
            
            window.firestore = db;
            window.firebaseEnabled = true;
            
            console.log('üî• Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π');
            
            // –£–≤–µ–¥–æ–º–ª—è–µ–º streak.js
            window.dispatchEvent(new CustomEvent('firebaseReady'));
        } catch(e) {
            console.warn('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π:', e);
            window.firebaseEnabled = false;
        }
    })();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1200px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: white;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .code-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .code-btn {
            padding: 8px 16px;
            font-size: 0.85rem;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .code-btn:hover {
            background: #667eea;
            color: white;
        }
        .status-indicator {
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        .status-online {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        .status-offline {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .status-dot.online {
            background: #4caf50;
        }
        .status-dot.offline {
            background: #f44336;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }
        .modal-text {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.6;
        }
        .code-display-box {
            background: #f5f5f5;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .code-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        .code-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        .code-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .modal-btn-primary:hover {
            opacity: 0.9;
        }
        .modal-btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        .modal-btn-secondary:hover {
            background: #e0e0e0;
        }
        .copy-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        .copy-btn:hover {
            background: #45a049;
        }
        .trainers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        .trainer-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-decoration: none;
            color: #333;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .trainer-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .trainer-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        .trainer-card h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .trainer-card p {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .card-phases { border-top: 4px solid #667eea; }
        .card-choice { border-top: 4px solid #f093fb; }
        .card-input { border-top: 4px solid #4facfe; }
        .card-simple { border-top: 4px solid #43e97b; }
        .card-dictionary { border-top: 4px solid #fa709a; }
        .card-wordslist { border-top: 4px solid #64748b; }
        
        /* –ë–ª–æ–∫ —Ü–µ–ª–∏ */
        .streak-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .streak-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .streak-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .streak-count {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        .streak-goal {
            font-size: 14px;
            color: #666;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 20px;
        }
        .streak-days {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .streak-day {
            width: 40px;
            height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: #f5f5f5;
            font-size: 12px;
        }
        .streak-day.completed {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .streak-day.today {
            border: 2px solid #667eea;
        }
        .streak-day .day-num {
            font-weight: 600;
            font-size: 14px;
        }
        .streak-day .day-icon {
            font-size: 16px;
        }
        .streak-progress {
            margin-top: 12px;
            text-align: center;
            font-size: 13px;
            color: #666;
        }
        .streak-progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        .streak-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .trainers-grid { grid-template-columns: 1fr; }
            .streak-day { width: 36px; height: 44px; }
        }
    </style>
</head>
<body class="main-page">
    <div class="container">
        <h1>üåô –ê—Ä–∞–±—Å–∫–∏–µ –¢—Ä–µ–Ω–∞–∂–µ—Ä—ã</h1>
        
        <!-- –ë–ª–æ–∫ —Ü–µ–ª–∏/—Å–µ—Ä–∏–∏ -->
        <div class="streak-card" id="streakCard">
            <div class="streak-header">
                <div class="streak-title">
                    üéØ –¶–µ–ª—å: <span id="streakGoalText">7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</span>
                </div>
                <div class="streak-count">üî• <span id="streakCount">0</span> –¥–Ω–µ–π</div>
            </div>
            <div class="streak-days" id="streakDays">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            <div class="streak-progress">
                <span id="streakProgressText">–°–µ–≥–æ–¥–Ω—è: 0/5 —Å–ª–æ–≤</span>
                <div class="streak-progress-bar">
                    <div class="streak-progress-fill" id="streakProgressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–æ–º -->
        <div class="code-buttons">
            <button class="code-btn" onclick="showMyCode()">–ú–æ–π –∫–æ–¥</button>
            <button class="code-btn" onclick="showEnterCode()">–í–≤–µ—Å—Ç–∏ –∫–æ–¥</button>
            <div class="status-indicator status-online" id="statusIndicator">
                <span class="status-dot online" id="statusDot"></span>
                <span id="statusText">–û–Ω–ª–∞–π–Ω</span>
            </div>
            <button class="theme-toggle-btn" id="themeToggleBtn" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
        </div>

        <div class="trainers-grid">
            <a href="phases.html" class="trainer-card card-phases">
                <div class="trainer-icon">üìä</div>
                <h3>–¢—Ä–µ–Ω–∞–∂–µ—Ä –¢–µ—Ç—Ä–∞–¥—å</h3>
                <p>–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —Å–ª–æ–≤–∞ –ø–æ—ç—Ç–∞–ø–Ω–æ</p>
            </a>

            <a href="dictionary.html" class="trainer-card card-dictionary">
                <div class="trainer-icon">üìö</div>
                <h3>–°–ª–æ–≤–∞—Ä—å</h3>
                <p>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ  —Å–ª–æ–≤–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã</p>
            </a>

            <a href="simple.html" class="trainer-card card-simple">
                <div class="trainer-icon">üìù</div>
                <h3>–ü—É—Å—Ç–æ–π –¢—Ä–µ–Ω–∞–∂–µ—Ä</h3>
                <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏ —Å–ª–æ–≤–∞ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å</p>
            </a>

            <a href="input.html" class="trainer-card card-input">
                <div class="trainer-icon">‚úçÔ∏è</div>
                <h3>–¢—Ä–µ–Ω–∞–∂–µ—Ä –ó–∞—É—á–∫–∞ + –ü—Ä–∞–∫—Ç–∏–∫–∞</h3>
                <p>–ó–∞—É—á–∏–≤–∞–π—Ç–µ —Å–ª–æ–≤–∞ –∏ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞—É—á–µ–Ω–Ω–æ–µ </p>
            </a>

            <a href="choice.html" class="trainer-card card-choice">
                <div class="trainer-icon">‚úÖ</div>
                <h3>–¢—Ä–µ–Ω–∞–∂–µ—Ä –í—ã–±–æ—Ä–∫–∞</h3>
                <p>–í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</p>
            </a>

            <a href="words-list.html" class="trainer-card card-wordslist">
                <div class="trainer-icon">üìã</div>
                <h3>–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤</h3>
                <p>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∏ –∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å–ª–æ–≤–∞</p>
            </a>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="modal-overlay" id="welcomeModal">
        <div class="modal-content">
            <div class="modal-title">üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
            <div class="modal-text">
                –í–∞—à –∫–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
            </div>
            <div class="code-display-box">
                <div class="code-value" id="welcomeCode"></div>
                <button class="copy-btn" onclick="copyWelcomeCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="modal-text" style="font-size: 0.9em; color: #999;">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ!
            </div>
            <button class="modal-btn modal-btn-primary" onclick="closeWelcomeModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ú–æ–π –∫–æ–¥" -->
    <div class="modal-overlay" id="myCodeModal">
        <div class="modal-content">
            <div class="modal-title">–í–∞—à –∫–æ–¥</div>
            <div class="code-display-box">
                <div class="code-value" id="myCodeValue"></div>
                <button class="copy-btn" onclick="copyMyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="modal-text" style="font-size: 0.9em; color: #999;">
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            </div>
            <button class="modal-btn modal-btn-primary" onclick="closeMyCodeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–í–≤–µ—Å—Ç–∏ –∫–æ–¥" -->
    <div class="modal-overlay" id="enterCodeModal">
        <div class="modal-content">
            <div class="modal-title">–í–≤–µ—Å—Ç–∏ –∫–æ–¥</div>
            <div class="modal-text">
                –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
            </div>
            <input type="text" class="code-input" id="codeInput" placeholder="ABCDEF" maxlength="6">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeEnterCodeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn modal-btn-primary" onclick="applyCode()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            <div class="modal-text">
                –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏–∑ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.<br><br>
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmApplyCode()">–î–∞, –ø—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞
        function generateCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üì¢ DOMContentLoaded —Å—Ä–∞–±–æ—Ç–∞–ª –≤ index.html');
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Å –∫–æ–¥–æ–º —Å—Ä–∞–∑—É - –∂–¥—ë–º –∑–∞–∫—Ä—ã—Ç–∏—è –¥—É–∞
            updateOnlineStatus();
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            document.querySelectorAll('.modal-content').forEach(content => {
                content.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            });
        });
        
        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è –¥—É–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª–∫–∏ —Å –∫–æ–¥–æ–º
        window.addEventListener('duaClosed', () => {
            console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ duaClosed');
            checkNewUser();
        });

        // –§–ª–∞–≥–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–∞–Ω–Ω–µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
        let modalJustOpened = false;

        // === –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞: localStorage + –∫—É–∫–∏ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤ ===
        function setCookie(name, value, days = 365) {
            const expires = new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
        }

        function getCookie(name) {
            return document.cookie.split('; ').reduce((acc, cur) => {
                const [k, v] = cur.split('=');
                return k === name ? decodeURIComponent(v) : acc;
            }, '');
        }

        function saveUserCode(code) {
            if (!code) return;
            localStorage.setItem('userProgressCode', code);
            setCookie('userProgressCode', code);
        }

        function getUserCode() {
            let code = localStorage.getItem('userProgressCode');
            if (!code) {
                code = getCookie('userProgressCode');
                if (code) {
                    console.log('‚úÖ –ö–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ cookie');
                    localStorage.setItem('userProgressCode', code);
                }
            }
            return code;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function checkNewUser() {
            console.log('üîç checkNewUser() –≤—ã–∑–≤–∞–Ω–∞');
            let userCode = getUserCode();
            console.log(`üîç –¢–µ–∫—É—â–∏–π –∫–æ–¥: "${userCode}"`);
            
            if (!userCode) {
                // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
                userCode = generateCode();
                saveUserCode(userCode);
                console.log('üéâ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å! –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫–æ–¥:', userCode);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º welcome modal —Å—Ä–∞–∑—É (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏, —Ç.–∫. –¥—É–∞ —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ)
                modalJustOpened = true;
                document.getElementById('welcomeCode').textContent = userCode;
                document.getElementById('welcomeModal').classList.add('show');
                console.log('‚úÖ Welcome modal –æ—Ç–∫—Ä—ã—Ç —Å –∫–æ–¥–æ–º');
                
                // –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 1000ms
                setTimeout(() => {
                    modalJustOpened = false;
                    console.log('‚úÖ –ú–æ–¥–∞–ª–∫–∞ —Å –∫–æ–¥–æ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è');
                }, 1000);
            } else {
                console.log('üëã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è, –∫–æ–¥ —É–∂–µ –µ—Å—Ç—å:', userCode);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å "–ú–æ–π –∫–æ–¥"
        function showMyCode() {
            const userCode = localStorage.getItem('userProgressCode');
            if (userCode) {
                modalJustOpened = true;
                document.getElementById('myCodeValue').textContent = userCode;
                document.getElementById('myCodeModal').classList.add('show');
                console.log('‚úÖ "–ú–æ–π –∫–æ–¥" modal –æ—Ç–∫—Ä—ã—Ç');
                setTimeout(() => { 
                    modalJustOpened = false;
                    console.log('‚úÖ –ú–æ–¥–∞–ª–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è');
                }, 1000);
            } else {
                alert('‚ö†Ô∏è –ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å "–í–≤–µ—Å—Ç–∏ –∫–æ–¥"
        function showEnterCode() {
            modalJustOpened = true;
            document.getElementById('codeInput').value = '';
            document.getElementById('enterCodeModal').classList.add('show');
            console.log('‚úÖ "–í–≤–µ—Å—Ç–∏ –∫–æ–¥" modal –æ—Ç–∫—Ä—ã—Ç');
            setTimeout(() => { 
                modalJustOpened = false;
                console.log('‚úÖ –ú–æ–¥–∞–ª–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è');
            }, 1000);
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–¥
        function applyCode() {
            const code = document.getElementById('codeInput').value.trim().toUpperCase();
            
            if (!code) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');
                return;
            }
            
            if (code.length !== 6) {
                alert('‚ö†Ô∏è –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            window.pendingCode = code;
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('enterCodeModal').classList.remove('show');
            document.getElementById('confirmModal').classList.add('show');
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
        function confirmApplyCode() {
            if (window.pendingCode) {
                saveUserCode(window.pendingCode);
                document.getElementById('confirmModal').classList.remove('show');
                alert('‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.');
                window.pendingCode = null;
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (welcome)
        function copyWelcomeCode() {
            const code = document.getElementById('welcomeCode').textContent;
            copyToClipboard(code);
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (–º–æ–π –∫–æ–¥)
        function copyMyCode() {
            const code = document.getElementById('myCodeValue').textContent;
            copyToClipboard(code);
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(() => {
                    alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥');
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const input = document.createElement('input');
                input.value = text;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                alert('‚úÖ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫–∏
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.remove('show');
        }

        function closeMyCodeModal() {
            document.getElementById('myCodeModal').classList.remove('show');
        }

        function closeEnterCodeModal() {
            document.getElementById('enterCodeModal').classList.remove('show');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
            window.pendingCode = null;
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay (—Ç–æ–ª—å–∫–æ –ø—Ä—è–º–æ–π –∫–ª–∏–∫ –Ω–∞ —Å–µ—Ä—É—é –æ–±–ª–∞—Å—Ç—å)
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (modalJustOpened) {
                    console.log('‚è∏Ô∏è –ö–ª–∏–∫ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è - –º–æ–¥–∞–ª–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã–ª–∞—Å—å');
                    return;
                }
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–∞–º overlay, –∞ –Ω–µ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                if (e.target === overlay) {
                    console.log('‚úÖ –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay');
                    overlay.classList.remove('show');
                }
            });
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω
        function updateOnlineStatus() {
            const indicator = document.getElementById('statusIndicator');
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            
            if (!indicator || !dot || !text) return;
            
            if (navigator.onLine) {
                // –û–Ω–ª–∞–π–Ω
                indicator.className = 'status-indicator status-online';
                dot.className = 'status-dot online';
                text.textContent = '–û–Ω–ª–∞–π–Ω';
            } else {
                // –û—Ñ–ª–∞–π–Ω
                indicator.className = 'status-indicator status-offline';
                dot.className = 'status-dot offline';
                text.textContent = '–û—Ñ–ª–∞–π–Ω';
            }
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ —Ü–µ–ª–∏/—Å–µ—Ä–∏–∏
        function updateStreakUI() {
            if (typeof getStreakInfo !== 'function') return;
            
            const info = getStreakInfo();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
            document.getElementById('streakCount').textContent = info.currentStreak;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏
            let goalText = formatGoalText(info.currentGoal);
            document.getElementById('streakGoalText').textContent = goalText;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            const progressText = info.todayComplete ? 
                '‚úÖ –°–µ–≥–æ–¥–Ω—è –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!' : 
                `–°–µ–≥–æ–¥–Ω—è: ${info.todayWords}/${info.wordsNeeded} —Å–ª–æ–≤`;
            document.getElementById('streakProgressText').textContent = progressText;
            
            const progressPercent = Math.min(100, (info.todayWords / info.wordsNeeded) * 100);
            document.getElementById('streakProgressFill').style.width = progressPercent + '%';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–Ω–∏
            if (typeof getStreakDays === 'function') {
                const days = getStreakDays(7);
                const daysContainer = document.getElementById('streakDays');
                daysContainer.innerHTML = days.map(day => `
                    <div class="streak-day ${day.completed ? 'completed' : ''} ${day.isToday ? 'today' : ''}">
                        <span class="day-num">${day.day}</span>
                        <span class="day-icon">${day.completed ? '‚úÖ' : (day.isToday ? 'üìç' : '‚òê')}</span>
                    </div>
                `).join('');
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ü–µ–ª–∏
        function formatGoalText(days) {
            if (days === 7) return '7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥';
            if (days === 30) return '1 –º–µ—Å—è—Ü';
            
            const years = Math.floor(days / 360);
            const months = Math.floor((days % 360) / 30);
            
            if (years === 0) {
                // –¢–æ–ª—å–∫–æ –º–µ—Å—è—Ü—ã
                return formatMonths(months);
            } else if (months === 0) {
                // –¢–æ–ª—å–∫–æ –≥–æ–¥–∞
                return formatYears(years);
            } else {
                // –ì–æ–¥–∞ –∏ –º–µ—Å—è—Ü—ã
                return `${formatYears(years)} ${formatMonths(months)}`;
            }
        }
        
        function formatYears(n) {
            if (n === 1) return '1 –≥–æ–¥';
            if (n >= 2 && n <= 4) return `${n} –≥–æ–¥–∞`;
            return `${n} –ª–µ—Ç`;
        }
        
        function formatMonths(n) {
            if (n === 1) return '1 –º–µ—Å.';
            return `${n} –º–µ—Å.`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        window.addEventListener('DOMContentLoaded', updateStreakUI);
        window.addEventListener('streakUpdated', updateStreakUI);
    </script>
</body>
</html>
