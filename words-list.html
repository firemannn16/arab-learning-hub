<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ - –ê—Ä–∞–±—Å–∫–∏–µ —Å–ª–æ–≤–∞</title>
  <script src="theme.js"></script>
  <link rel="stylesheet" href="theme.css">
  <script src="service-worker-register.js"></script>
  <script src="sidebar-menu.js"></script>
  <script src="favorites.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f7fa;
      color: #1f2937;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .header h1 {
      font-size: 24px;
      color: #333;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .clear-fav-btn {
      padding: 8px 10px;
      background: #fff5f5;
      color: #d14343;
      border: 1px solid #f8caca;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .clear-fav-btn:hover {
      background: #ffecec;
      box-shadow: 0 2px 8px rgba(209, 67, 67, 0.25);
    }

    .word-count {
      font-size: 14px;
      color: #6b7280;
      background: #f3f4f6;
      padding: 6px 12px;
      border-radius: 20px;
    }

    .copy-all-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .copy-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .copy-all-btn:active {
      transform: translateY(0);
    }

    /* –¢–∞–±—ã */
    .tabs {
      display: flex;
      gap: 10px;
      border-top: 1px solid #e5e7eb;
      padding-top: 15px;
    }

    .tab-btn {
      padding: 10px 20px;
      border: none;
      background: #f3f4f6;
      color: #6b7280;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-btn:hover {
      background: #e5e7eb;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .tab-badge {
      background: rgba(255,255,255,0.2);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
    }

    .tab-btn:not(.active) .tab-badge {
      background: #d1d5db;
      color: #374151;
    }

    .words-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .word-item {
      padding: 14px 20px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .word-item:hover {
      background: #f8f9ff;
    }

    .word-item:last-child {
      border-bottom: none;
    }

    .word-item.copied {
      background: #e8f5e9;
    }

    .word-text {
      flex: 1;
      font-size: 16px;
      line-height: 1.8;
      word-break: break-word;
    }

    .word-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .star-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
      opacity: 0.4;
      transition: all 0.2s;
    }

    .star-btn:hover {
      opacity: 1;
      transform: scale(1.2);
    }

    .star-btn.active {
      opacity: 1;
    }

    .copy-icon {
      opacity: 0;
      color: #667eea;
      font-size: 14px;
      padding: 4px 8px;
      transition: opacity 0.2s;
    }

    .word-item:hover .copy-icon {
      opacity: 1;
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 9999;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
      font-size: 16px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      text-align: center;
      padding: 40px 20px;
      color: #ef4444;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .empty-state p {
      font-size: 16px;
    }

    /* ========== –ó–ê–£–ß–ò–í–ê–ù–ò–ï –°–¢–ò–õ–ò ========== */
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞—É—á–∏–≤–∞–Ω–∏—è */
    .learn-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      padding: 30px;
    }

    /* –ù–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
    .learn-input-section {
      text-align: center;
    }

    .learn-input-section h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 8px;
    }

    .learn-input-section p {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .learn-textarea {
      width: 100%;
      min-height: 200px;
      padding: 15px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      font-family: 'Amiri', 'Segoe UI', Arial, sans-serif;
      line-height: 2;
      resize: vertical;
      transition: border-color 0.2s;
    }

    .learn-textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .learn-textarea::placeholder {
      color: #9ca3af;
    }

    .learn-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .learn-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .learn-btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .learn-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .learn-btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .learn-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .learn-btn-secondary:hover {
      background: #e5e7eb;
    }

    /* –¢–∞–π–º–µ—Ä scroll-picker */
    .timer-section {
      margin: 25px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .timer-label {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 15px;
    }

    .picker-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .picker-container {
      position: relative;
      width: 90px;
      height: 150px;
    }

    .picker-highlight {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 50px;
      background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
      border: 2px solid #667eea;
      border-radius: 12px;
      pointer-events: none;
      z-index: 2;
    }

    .picker-scroll {
      height: 100%;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      scrollbar-width: none;
      -ms-overflow-style: none;
      -webkit-overflow-scrolling: touch;
      padding: 50px 0;
      mask-image: linear-gradient(transparent 0%, black 35%, black 65%, transparent 100%);
      -webkit-mask-image: linear-gradient(transparent 0%, black 35%, black 65%, transparent 100%);
    }

    .picker-scroll::-webkit-scrollbar {
      display: none;
    }

    .picker-item {
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      scroll-snap-align: center;
      font-size: 22px;
      color: #9ca3af;
      user-select: none;
      transition: color 0.15s, font-size 0.15s, font-weight 0.15s;
    }

    .picker-item.selected {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
    }

    .picker-unit {
      font-size: 18px;
      color: #6b7280;
      font-weight: 500;
    }

    /* –†–µ–∂–∏–º –∑–∞—É—á–∏–≤–∞–Ω–∏—è/–ø—Ä–æ–≤–µ—Ä–∫–∏ */
    .learn-mode {
      text-align: center;
    }

    .learn-progress-bar {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      margin-bottom: 25px;
      overflow: hidden;
    }

    .learn-progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .learn-progress-text {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 10px;
    }

    /* –ö—Ä—É–≥–ª—ã–π —Ç–∞–π–º–µ—Ä */
    .circle-timer {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 25px;
    }

    .circle-timer svg {
      transform: rotate(-90deg);
      width: 100px;
      height: 100px;
    }

    .circle-timer-bg {
      fill: none;
      stroke: #e5e7eb;
      stroke-width: 6;
    }

    .circle-timer-progress {
      fill: none;
      stroke: url(#timerGradient);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.1s linear;
    }

    .circle-timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      font-weight: bold;
      color: #667eea;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–ª–æ–≤–∞ */
    .word-card {
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 35px 25px;
      margin: 20px 0;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.4s ease;
      overflow: visible;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .word-card-arabic {
      font-size: 32px;
      font-family: 'Amiri', 'Traditional Arabic', serif;
      color: #1a1a2e;
      line-height: 2.4;
      margin-bottom: 15px;
      direction: rtl;
      text-align: center;
      word-spacing: 8px;
      padding: 18px 10px 8px 10px;
      overflow: visible;
      display: inline-block;
    }

    .word-card-translation {
      font-size: 18px;
      color: #4b5563;
      line-height: 1.6;
    }

    .word-card-hidden .word-card-translation {
      display: none;
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .learn-controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .control-btn {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-pause {
      background: #fef3c7;
      color: #92400e;
    }

    .btn-pause:hover {
      background: #fde68a;
    }

    .btn-next {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-next:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-know {
      background: #d1fae5;
      color: #065f46;
    }

    .btn-know:hover {
      background: #a7f3d0;
    }

    .btn-forgot {
      background: #fee2e2;
      color: #991b1b;
    }

    .btn-forgot:hover {
      background: #fecaca;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
      animation: fadeInOverlay 0.2s ease;
    }

    @keyframes fadeInOverlay {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 30px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .modal-title {
      font-size: 20px;
      color: #1f2937;
      margin-bottom: 10px;
    }

    .modal-text {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .modal-stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 25px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
    }

    .stat-value.green { color: #059669; }
    .stat-value.red { color: #dc2626; }

    .stat-label {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }

    .modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-btn {
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .modal-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .modal-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-btn-secondary:hover {
      background: #e5e7eb;
    }

    .modal-btn-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .modal-btn-danger:hover {
      background: #fecaca;
    }

    /* –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥ (–≥–ª–∞–∑–æ–∫) */
    .show-translation-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border: none;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 10;
    }

    .show-translation-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: scale(1.1);
    }

    .show-translation-btn:active {
      transform: scale(0.95);
    }

    .show-translation-btn.active {
      background: rgba(102, 126, 234, 0.3);
    }

    .word-card {
      position: relative;
    }

    /* –°—Ç–∞—Ç—É—Å –ø–∞—É–∑–∞ */
    .paused-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      z-index: 5;
    }

    .paused-text {
      font-size: 24px;
      color: #6b7280;
      margin-bottom: 15px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 600px) {
      body {
        padding: 15px;
      }

      .header {
        padding: 15px;
      }

      .header h1 {
        font-size: 20px;
      }

      .word-item {
        padding: 12px 15px;
      }

      .word-text {
        font-size: 15px;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .tab-btn {
        flex: 1;
        justify-content: center;
        min-width: 100px;
        padding: 10px 12px;
        font-size: 13px;
      }

      .learn-container {
        padding: 20px 15px;
      }

      .word-card {
        padding: 28px 16px;
        min-height: 190px;
        overflow: visible;
      }
      
      .word-card-arabic {
        font-size: 26px;
        line-height: 2.5;
        padding: 16px 12px 8px 12px;
        overflow: visible;
        display: inline-block;
      }

      .word-card-translation {
        font-size: 16px;
      }

      .learn-controls {
        flex-direction: column;
      }

      .control-btn {
        width: 100%;
        justify-content: center;
      }

      .modal-stats {
        gap: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-top">
        <h1>üìã –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤</h1>
        <div class="header-info">
          <span class="word-count" id="wordCount">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          <button class="copy-all-btn" id="copyAllBtn" disabled>
            <span>üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë
          </button>
          <button class="clear-fav-btn" id="clearFavBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">üóëÔ∏è</button>
        </div>
      </div>
      <div class="tabs">
        <button class="tab-btn active" id="tabAll" onclick="showTab('all')">
          üìö –í—Å–µ —Å–ª–æ–≤–∞ <span class="tab-badge" id="allCount">0</span>
        </button>
        <button class="tab-btn" id="tabFavorites" onclick="showTab('favorites')">
          ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ <span class="tab-badge" id="favCount">0</span>
        </button>
        <button class="tab-btn" id="tabLearn" onclick="showTab('learn')">
          üéØ –ó–∞—É—á–∏–≤–∞–Ω–∏–µ
        </button>
      </div>
    </div>

    <div class="words-container" id="wordsContainer">
      <div class="loading">
        <div class="loading-spinner"></div>
        –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤...
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞—É—á–∏–≤–∞–Ω–∏—è -->
    <div class="learn-container" id="learnContainer" style="display: none;">
      <!-- –ù–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
      <div class="learn-input-section" id="learnInputSection">
        <h2>üéØ –ó–∞—É—á–∏–≤–∞–Ω–∏–µ —Å–ª–æ–≤</h2>
        <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: <strong>–ø–µ—Ä–µ–≤–æ–¥ ‚Äî –∞—Ä–∞–±—Å–∫–∏–π</strong></p>
        
        <textarea class="learn-textarea" id="learnTextarea" placeholder="—ç–∫–∑–µ–º–ø–ª—è—Ä, –∫–Ω–∏–≥–∞ ‚Äî ŸÖŸèÿµŸíÿ≠ŸéŸÅŸå - ŸÖŸéÿµŸéÿßÿ≠ŸêŸÅŸè&#10;–≤–æ–¥–∞ ‚Äî ŸÖŸéÿßÿ°Ÿå&#10;–∫–Ω–∏–≥–∞ ‚Äî ŸÉŸêÿ™Ÿéÿßÿ®Ÿå - ŸÉŸèÿ™Ÿèÿ®Ÿå"></textarea>
        
        <div class="timer-section">
          <span class="timer-label">‚è±Ô∏è –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏</span>
          <div class="picker-wrapper">
            <div class="picker-container">
              <div class="picker-highlight"></div>
              <div class="picker-scroll" id="pickerScroll">
                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã 0-60 –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JavaScript -->
              </div>
            </div>
            <span class="picker-unit">—Å–µ–∫</span>
          </div>
        </div>
        
        <div class="learn-actions">
          <button class="learn-btn learn-btn-secondary" onclick="pasteFromClipboard()">
            üìã –í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞
          </button>
          <button class="learn-btn learn-btn-primary" id="startLearnBtn" onclick="startLearning()">
            ‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∑–∞—É—á–∏–≤–∞–Ω–∏–µ
          </button>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º –∑–∞—É—á–∏–≤–∞–Ω–∏—è -->
      <div class="learn-mode" id="learnModeSection" style="display: none;">
        <div class="learn-progress-text" id="learnProgressText">–°–ª–æ–≤–æ 1 –∏–∑ 10</div>
        <div class="learn-progress-bar">
          <div class="learn-progress-fill" id="learnProgressFill" style="width: 0%"></div>
        </div>
        
        <div class="circle-timer" id="circleTimer">
          <svg viewBox="0 0 100 100">
            <defs>
              <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#667eea"/>
                <stop offset="100%" style="stop-color:#764ba2"/>
              </linearGradient>
            </defs>
            <circle class="circle-timer-bg" cx="50" cy="50" r="45"/>
            <circle class="circle-timer-progress" id="timerProgress" cx="50" cy="50" r="45" 
              stroke-dasharray="283" stroke-dashoffset="0"/>
          </svg>
          <div class="circle-timer-text" id="timerText">15</div>
        </div>
        
        <div class="word-card" id="wordCard">
          <div class="word-card-arabic" id="cardArabic">ŸÖŸèÿµŸíÿ≠ŸéŸÅŸå - ŸÖŸéÿµŸéÿßÿ≠ŸêŸÅŸè</div>
          <div class="word-card-translation" id="cardTranslation">—ç–∫–∑–µ–º–ø–ª—è—Ä, –∫–Ω–∏–≥–∞</div>
        </div>
        
        <div class="learn-controls">
          <button class="control-btn btn-pause" id="pauseBtn" onclick="togglePause()">
            ‚è∏Ô∏è –ü–∞—É–∑–∞
          </button>
          <button class="control-btn btn-next" onclick="nextWord()">
            ‚ñ∂Ô∏è –î–∞–ª–µ–µ
          </button>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
      <div class="learn-mode" id="testModeSection" style="display: none;">
        <div class="learn-progress-text" id="testProgressText">–ü—Ä–æ–≤–µ—Ä–∫–∞ 1 –∏–∑ 10</div>
        <div class="learn-progress-bar">
          <div class="learn-progress-fill" id="testProgressFill" style="width: 0%"></div>
        </div>
        
        <div class="circle-timer" id="testCircleTimer">
          <svg viewBox="0 0 100 100">
            <defs>
              <linearGradient id="timerGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#667eea"/>
                <stop offset="100%" style="stop-color:#764ba2"/>
              </linearGradient>
            </defs>
            <circle class="circle-timer-bg" cx="50" cy="50" r="45"/>
            <circle class="circle-timer-progress" id="testTimerProgress" cx="50" cy="50" r="45" 
              stroke-dasharray="283" stroke-dashoffset="0" style="stroke: url(#timerGradient2)"/>
          </svg>
          <div class="circle-timer-text" id="testTimerText">15</div>
        </div>
        
        <div class="word-card word-card-hidden" id="testWordCard">
          <button class="show-translation-btn" id="showTranslationBtn" onclick="toggleTranslation()" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥">
            üëÅÔ∏è
          </button>
          <div class="word-card-arabic" id="testCardArabic">ŸÖŸèÿµŸíÿ≠ŸéŸÅŸå - ŸÖŸéÿµŸéÿßÿ≠ŸêŸÅŸè</div>
          <div class="word-card-translation" id="testCardTranslation">—ç–∫–∑–µ–º–ø–ª—è—Ä, –∫–Ω–∏–≥–∞</div>
        </div>
        
        <div class="learn-controls">
          <button class="control-btn btn-pause" id="testPauseBtn" onclick="toggleTestPause()">
            ‚è∏Ô∏è –ü–∞—É–∑–∞
          </button>
          <button class="control-btn btn-forgot" onclick="markForgot()">
            ‚úó –Ø –∑–∞–±—ã–ª
          </button>
          <button class="control-btn btn-know" onclick="markKnow()">
            ‚úì –Ø –∑–Ω–∞—é
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
  <div class="modal-overlay" id="modalOverlay" style="display: none;">
    <div class="modal-content" id="modalContent">
      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
  </div>

  <div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

  <script>
    let allWordsText = '';
    let allWords = [];
    let currentTab = 'all';

    // ========== –ó–ê–£–ß–ò–í–ê–ù–ò–ï - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ==========
    let learnWords = [];           // –°–ª–æ–≤–∞ –¥–ª—è –∑–∞—É—á–∏–≤–∞–Ω–∏—è [{arabic: '...', translation: '...'}, ...]
    let currentWordIndex = 0;      // –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å —Å–ª–æ–≤–∞
    let selectedTime = 15;         // –í—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—Å–µ–∫)
    let timerInterval = null;      // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∞–π–º–µ—Ä–∞
    let timeLeft = 15;             // –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
    let isPaused = false;          // –§–ª–∞–≥ –ø–∞—É–∑—ã
    let learnMode = 'learn';       // –†–µ–∂–∏–º: 'learn' –∏–ª–∏ 'test'
    let forgottenWords = [];       // –ó–∞–±—ã—Ç—ã–µ —Å–ª–æ–≤–∞
    let knownCount = 0;            // –°—á—ë—Ç—á–∏–∫ "–∑–Ω–∞—é"
    let forgotCount = 0;           // –°—á—ë—Ç—á–∏–∫ "–∑–∞–±—ã–ª"
    const TIMER_STORAGE_KEY = 'arabTimerSeconds';
    const SESSION_STORAGE_KEY = 'arabLearnSession';
    let audioContext = null;

    // –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å AudioContext
    function getAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioContext;
    }

    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å AudioContext (–Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    function unlockAudio() {
      const ctx = getAudioContext();
      if (ctx.state === 'suspended') {
        ctx.resume();
      }
      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç–∏—Ö–∏–π –∑–≤—É–∫ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ iOS
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      gainNode.gain.value = 0.001; // –ü–æ—á—Ç–∏ –±–µ–∑–∑–≤—É—á–Ω–æ
      oscillator.start();
      oscillator.stop(ctx.currentTime + 0.01);
    }

    // –ó–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ (–£—Å–ø–µ—Ö - –≤–æ—Å—Ö–æ–¥—è—â–∞—è –º–µ–ª–æ–¥–∏—è)
    function playTimerSound() {
      try {
        const ctx = getAudioContext();
        
        // –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω
        if (ctx.state === 'suspended') {
          ctx.resume();
        }
        
        const notes = [392, 494, 587, 784]; // G4, B4, D5, G5
        
        notes.forEach((freq, i) => {
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          
          oscillator.frequency.value = freq;
          oscillator.type = 'sine';
          
          const startTime = ctx.currentTime + i * 0.1;
          gainNode.gain.setValueAtTime(0.2, startTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.25);
          
          oscillator.start(startTime);
          oscillator.stop(startTime + 0.25);
        });
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫:', e);
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (e) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        return true;
      }
    }

    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å/–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä
    function saveTimerPreference(seconds) {
      try {
        localStorage.setItem(TIMER_STORAGE_KEY, String(seconds));
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä', e);
      }
    }

    function loadTimerPreference() {
      try {
        const saved = localStorage.getItem(TIMER_STORAGE_KEY);
        const parsed = parseInt(saved, 10);
        if (!isNaN(parsed)) {
          return Math.max(1, Math.min(60, parsed));
        }
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–π–º–µ—Ä', e);
      }
      return 15;
    }

    // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê ==========
    
    function saveSession() {
      if (learnWords.length === 0) return;
      
      try {
        const sessionData = {
          learnWords: learnWords,
          currentWordIndex: currentWordIndex,
          learnMode: learnMode,
          forgottenWords: forgottenWords,
          knownCount: knownCount,
          forgotCount: forgotCount,
          selectedTime: selectedTime,
          textareaContent: document.getElementById('learnTextarea')?.value || '',
          timestamp: Date.now()
        };
        localStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(sessionData));
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é', e);
      }
    }

    function loadSession() {
      try {
        const saved = localStorage.getItem(SESSION_STORAGE_KEY);
        if (saved) {
          return JSON.parse(saved);
        }
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é', e);
      }
      return null;
    }

    function clearSession() {
      try {
        localStorage.removeItem(SESSION_STORAGE_KEY);
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é', e);
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function checkSavedSession() {
      const session = loadSession();
      if (session && session.learnWords && session.learnWords.length > 0) {
        showResumeModal(session, true); // true = –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ"
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∑–∞—É—á–∏–≤–∞–Ω–∏–µ
    function checkSavedSessionOnLearnTab() {
      const session = loadSession();
      if (session && session.learnWords && session.learnWords.length > 0) {
        showResumeModal(session, false); // false = –±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ"
      }
    }

    function showResumeModal(session, showPostponeButton) {
      const overlay = document.getElementById('modalOverlay');
      const content = document.getElementById('modalContent');
      
      const modeText = session.learnMode === 'learn' ? '–∑–∞—É—á–∏–≤–∞–Ω–∏–µ' : '–ø—Ä–æ–≤–µ—Ä–∫–∞';
      const progressText = `${session.currentWordIndex + 1} –∏–∑ ${session.learnWords.length}`;
      
      const postponeButtonHtml = showPostponeButton 
        ? `<button class="modal-btn modal-btn-secondary" onclick="postponeSession()">
            ‚è∞ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ
          </button>`
        : '';
      
      content.innerHTML = `
        <div class="modal-icon">üìö</div>
        <div class="modal-title">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–µ—Å—Å–∏—é?</div>
        <div class="modal-text">
          –ù–∞–π–¥–µ–Ω–∞ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è:<br>
          <strong>${modeText}</strong> ‚Äî —Å–ª–æ–≤–æ ${progressText}
        </div>
        <div class="modal-buttons">
          <button class="modal-btn modal-btn-primary" onclick="resumeSession()">
            ‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
          </button>
          <button class="modal-btn modal-btn-danger" onclick="startFresh()">
            üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
          </button>
          ${postponeButtonHtml}
        </div>
      `;
      overlay.style.display = 'flex';
    }

    // –û—Ç–ª–æ–∂–∏—Ç—å —Å–µ—Å—Å–∏—é ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ, —Å–µ—Å—Å–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –≤ localStorage
    function postponeSession() {
      closeModal();
    }

    function resumeSession() {
      const session = loadSession();
      if (!session) {
        closeModal();
        return;
      }
      
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      learnWords = session.learnWords;
      currentWordIndex = session.currentWordIndex;
      learnMode = session.learnMode;
      forgottenWords = session.forgottenWords || [];
      knownCount = session.knownCount || 0;
      forgotCount = session.forgotCount || 0;
      selectedTime = session.selectedTime || 15;
      isPaused = false;
      
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –≤ textarea
      if (session.textareaContent) {
        document.getElementById('learnTextarea').value = session.textareaContent;
      }
      
      closeModal();
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∑–≤—É–∫
      unlockAudio();
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞—É—á–∏–≤–∞–Ω–∏—è
      showTab('learn');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ä–µ–∂–∏–º
      document.getElementById('learnInputSection').style.display = 'none';
      
      if (learnMode === 'learn') {
        document.getElementById('learnModeSection').style.display = 'block';
        document.getElementById('testModeSection').style.display = 'none';
        showCurrentWord();
      } else {
        document.getElementById('learnModeSection').style.display = 'none';
        document.getElementById('testModeSection').style.display = 'block';
        showTestWord();
      }
      
      startTimer();
    }

    function startFresh() {
      clearSession();
      closeModal();
    }

    function highlightPickerValue(value) {
      const picker = document.getElementById('pickerScroll');
      if (!picker) return;
      picker.querySelectorAll('.picker-item').forEach(el => {
        el.classList.toggle('selected', parseInt(el.dataset.value, 10) === value);
      });
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function showTab(tab) {
      currentTab = tab;
      
      document.getElementById('tabAll').classList.toggle('active', tab === 'all');
      document.getElementById('tabFavorites').classList.toggle('active', tab === 'favorites');
      document.getElementById('tabLearn').classList.toggle('active', tab === 'learn');
      
      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
      document.getElementById('wordsContainer').style.display = (tab === 'all' || tab === 'favorites') ? 'block' : 'none';
      document.getElementById('learnContainer').style.display = tab === 'learn' ? 'block' : 'none';
      
      // –°–∫—Ä—ã—Ç—å header-info –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –∑–∞—É—á–∏–≤–∞–Ω–∏—è
      document.querySelector('.header-info').style.display = tab === 'learn' ? 'none' : 'flex';
      
      // –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É ‚Äî —Å–±—Ä–æ—Å –∑–∞—É—á–∏–≤–∞–Ω–∏—è (–Ω–æ –Ω–µ localStorage)
      if (tab !== 'learn') {
        resetLearning();
      }
      
      // –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞—É—á–∏–≤–∞–Ω–∏—è ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é (–±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ø–æ–∑–∂–µ")
      if (tab === 'learn') {
        checkSavedSessionOnLearnTab();
      }
      
      if (tab === 'all' || tab === 'favorites') {
        renderWords();
        updateCounts();
      }
    }

    // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏
    function updateCounts() {
      document.getElementById('allCount').textContent = allWords.length;
      document.getElementById('favCount').textContent = getFavoritesCount();
      
      if (currentTab === 'all') {
        document.getElementById('wordCount').textContent = `${allWords.length} —Å–ª–æ–≤`;
      } else {
        document.getElementById('wordCount').textContent = `${getFavoritesCount()} –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö`;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ª–æ–≤
    function renderWords() {
      const container = document.getElementById('wordsContainer');
      let wordsToShow = currentTab === 'all' ? allWords : getFavorites();
      
      if (wordsToShow.length === 0) {
        if (currentTab === 'favorites') {
          container.innerHTML = `
            <div class="empty-state">
              <div class="icon">‚≠ê</div>
              <p>–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤</p>
              <p style="font-size: 14px; margin-top: 8px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–≤–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–æ–≤</p>
            </div>
          `;
        } else {
          container.innerHTML = '<div class="error">–ù–µ—Ç —Å–ª–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
        }
        return;
      }

      let html = '';
      wordsToShow.forEach((line) => {
        const cleanLine = typeof line === 'string' ? line.trim() : line;
        if (cleanLine) {
          const isFav = isFavorite(cleanLine);
          html += `
            <div class="word-item" data-text="${escapeHtml(cleanLine).replace(/"/g, '&quot;')}">
              <span class="word-text">${escapeHtml(cleanLine)}</span>
              <div class="word-actions">
                <button class="star-btn ${isFav ? 'active' : ''}" onclick="toggleStar(event, this)" title="${isFav ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}">
                  ${isFav ? '‚≠ê' : '‚òÜ'}
                </button>
                <span class="copy-icon" onclick="copyWord(event, this.parentElement.parentElement)">üìã</span>
              </div>
            </div>
          `;
        }
      });

      container.innerHTML = html;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    function toggleStar(event, btn) {
      event.stopPropagation();
      const wordItem = btn.closest('.word-item');
      const text = wordItem.getAttribute('data-text');
      
      const isNowFavorite = toggleFavorite(text);
      
      btn.classList.toggle('active', isNowFavorite);
      btn.innerHTML = isNowFavorite ? '‚≠ê' : '‚òÜ';
      btn.title = isNowFavorite ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
      
      showToast(isNowFavorite ? '–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ' : '–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
      
      // –ï—Å–ª–∏ –º—ã –≤ —Ç–∞–±–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∏ —É–¥–∞–ª–∏–ª–∏ —Å–ª–æ–≤–æ - –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å
      if (currentTab === 'favorites' && !isNowFavorite) {
        setTimeout(() => renderWords(), 300);
      }
      
      updateCounts();
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–æ
    async function copyWord(event, element) {
      event.stopPropagation();
      const text = element.getAttribute('data-text');
      await copyText(text);
      
      element.classList.add('copied');
      setTimeout(() => {
        element.classList.remove('copied');
      }, 500);
      
      showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤
    async function loadWords() {
      const container = document.getElementById('wordsContainer');
      const copyAllBtn = document.getElementById('copyAllBtn');

      try {
        const response = await fetch('words.txt');
        if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        
        const text = await response.text();
        allWordsText = text;
        
        allWords = text.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));
        
        copyAllBtn.disabled = false;
        
        renderWords();
        updateCounts();

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        container.innerHTML = '<div class="error">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤</div>';
        document.getElementById('wordCount').textContent = '–û—à–∏–±–∫–∞';
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë
    document.getElementById('copyAllBtn').addEventListener('click', async () => {
      let textToCopy;
      if (currentTab === 'all') {
        textToCopy = allWordsText;
      } else {
        textToCopy = getFavoritesAsText();
      }
      
      if (textToCopy) {
        await copyText(textToCopy);
        showToast(currentTab === 'all' ? '–í–µ—Å—å —Å–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!' : '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    document.getElementById('clearFavBtn').addEventListener('click', () => {
      localStorage.removeItem('arabFavorites');
      window.dispatchEvent(new CustomEvent('favoritesChanged', { detail: { action: 'clear' } }));
      showToast('–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –æ—á–∏—â–µ–Ω–æ');
      if (currentTab === 'favorites') {
        renderWords();
      }
      updateCounts();
    });

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    window.addEventListener('favoritesChanged', () => {
      if (currentTab === 'favorites') {
        renderWords();
      }
      updateCounts();
    });

    // –ö–ª–∏–∫ –Ω–∞ —Å—Ç—Ä–æ–∫—É - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
    document.getElementById('wordsContainer').addEventListener('click', async (e) => {
      const wordItem = e.target.closest('.word-item');
      if (wordItem && !e.target.closest('.star-btn') && !e.target.closest('.copy-icon')) {
        const text = wordItem.getAttribute('data-text');
        await copyText(text);
        wordItem.classList.add('copied');
        setTimeout(() => wordItem.classList.remove('copied'), 500);
        showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
      }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadWords();

    // ========== –ó–ê–£–ß–ò–í–ê–ù–ò–ï - –§—É–Ω–∫—Ü–∏–∏ ==========

    // –ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    function parseWords(text) {
      const lines = text.split('\n').filter(line => line.trim());
      const parsed = [];
      
      for (const line of lines) {
        // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ –ª—é–±–æ–º—É —Ç–∏—Ä–µ: -, ‚Äì, ‚Äî
        const parts = line.split(/\s*[-‚Äì‚Äî]\s*/);
        
        if (parts.length >= 2) {
          // –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å - –ø–µ—Ä–µ–≤–æ–¥, –æ—Å—Ç–∞–ª—å–Ω–æ–µ - –∞—Ä–∞–±—Å–∫–∏–π
          const translation = parts[0].trim();
          const arabic = parts.slice(1).join(' - ').trim();
          
          if (translation && arabic) {
            parsed.push({ translation, arabic });
          }
        }
      }
      
      return parsed;
    }

    // –í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
    async function pasteFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('learnTextarea').value = text;
        showToast('–í—Å—Ç–∞–≤–ª–µ–Ω–æ –∏–∑ –±—É—Ñ–µ—Ä–∞!');
      } catch (e) {
        showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É');
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è scroll-picker
    function initPicker() {
      const picker = document.getElementById('pickerScroll');
      picker.innerHTML = '';
      const savedTime = loadTimerPreference();
      selectedTime = savedTime;
      
      // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç—ã 1-60
      for (let i = 1; i <= 60; i++) {
        const item = document.createElement('div');
        item.className = 'picker-item';
        item.dataset.value = i;
        item.textContent = i;
        item.addEventListener('click', () => {
          setTime(i);
        });
        picker.appendChild(item);
      }
      
      // IntersectionObserver –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
            const value = parseInt(entry.target.dataset.value);
            if (value !== selectedTime) {
              selectedTime = value;
              // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª–∏
              picker.querySelectorAll('.picker-item').forEach(item => {
                item.classList.toggle('selected', parseInt(item.dataset.value) === value);
              });
              saveTimerPreference(selectedTime);
            }
          }
        });
      }, {
        root: picker,
        rootMargin: '-50px 0px -50px 0px',
        threshold: 0.5
      });
      
      // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –≤—Å–µ–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
      picker.querySelectorAll('.picker-item').forEach(item => {
        observer.observe(item);
      });
      
      // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é (15)
      setTimeout(() => {
        setTime(savedTime);
      }, 50);
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –∏ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–µ–º—É
    function setTime(seconds) {
      seconds = Math.max(1, Math.min(60, seconds));
      selectedTime = seconds;
      saveTimerPreference(seconds);
      
      const picker = document.getElementById('pickerScroll');
      const item = picker.querySelector(`[data-value="${seconds}"]`);
      if (item) {
        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª–∏
        picker.querySelectorAll('.picker-item').forEach(el => {
          el.classList.toggle('selected', parseInt(el.dataset.value) === seconds);
        });
      }
    }

    // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–∏–∫–µ—Ä–∞
    function getPickerSelectedValue() {
      const picker = document.getElementById('pickerScroll');
      if (!picker) return selectedTime;
      
      const rect = picker.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const element = document.elementFromPoint(centerX, centerY);
      
      if (element && element.classList.contains('picker-item')) {
        const value = parseInt(element.dataset.value, 10);
        if (!isNaN(value)) return value;
      }
      
      const selectedEl = picker.querySelector('.picker-item.selected');
      if (selectedEl) {
        const value = parseInt(selectedEl.dataset.value, 10);
        if (!isNaN(value)) return value;
      }
      
      return selectedTime;
    }

    // –ù–∞—á–∞—Ç—å –∑–∞—É—á–∏–≤–∞–Ω–∏–µ
    function startLearning() {
      const text = document.getElementById('learnTextarea').value;
      learnWords = parseWords(text);
      
      if (learnWords.length === 0) {
        showToast('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –¥–ª—è –∑–∞—É—á–∏–≤–∞–Ω–∏—è');
        return;
      }
      
      // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ (–≤–∞–∂–Ω–æ –¥–ª—è iOS/Android)
      unlockAudio();
      
      // –í–ê–ñ–ù–û: –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –î–û —Å–∫—Ä—ã—Ç–∏—è picker!
      let currentValue = getPickerSelectedValue();
      if (isNaN(currentValue)) currentValue = selectedTime;
      currentValue = Math.max(1, Math.min(60, currentValue));
      selectedTime = currentValue;
      saveTimerPreference(selectedTime);
      
      currentWordIndex = 0;
      learnMode = 'learn';
      isPaused = false;
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∂–∏–º –∑–∞—É—á–∏–≤–∞–Ω–∏—è (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞)
      document.getElementById('learnInputSection').style.display = 'none';
      document.getElementById('learnModeSection').style.display = 'block';
      document.getElementById('testModeSection').style.display = 'none';
      
      showCurrentWord();
      startTimer();
      saveSession();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–ª–æ–≤–æ (—Ä–µ–∂–∏–º –∑–∞—É—á–∏–≤–∞–Ω–∏—è)
    function showCurrentWord() {
      if (currentWordIndex >= learnWords.length) {
        finishLearning();
        return;
      }
      
      const word = learnWords[currentWordIndex];
      document.getElementById('cardArabic').textContent = word.arabic;
      document.getElementById('cardTranslation').textContent = word.translation;
      
      // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
      const progress = ((currentWordIndex + 1) / learnWords.length) * 100;
      document.getElementById('learnProgressFill').style.width = progress + '%';
      document.getElementById('learnProgressText').textContent = 
        `–°–ª–æ–≤–æ ${currentWordIndex + 1} –∏–∑ ${learnWords.length}`;
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
      const card = document.getElementById('wordCard');
      card.style.animation = 'none';
      card.offsetHeight; // Trigger reflow
      card.style.animation = 'fadeIn 0.4s ease';
    }

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä
    function startTimer() {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π selectedTime (–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–¥–∞–Ω –¥–æ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏)
      timeLeft = selectedTime;
      updateTimerDisplay();
      
      if (timerInterval) clearInterval(timerInterval);
      
      timerInterval = setInterval(() => {
        if (!isPaused) {
          timeLeft--;
          updateTimerDisplay();
          
          if (timeLeft <= 0) {
            playTimerSound();
            if (learnMode === 'learn') {
              nextWord();
            } else {
              nextTestWord();
            }
          }
        }
      }, 1000);
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
    function updateTimerDisplay() {
      const progressId = learnMode === 'learn' ? 'timerProgress' : 'testTimerProgress';
      const textId = learnMode === 'learn' ? 'timerText' : 'testTimerText';
      
      document.getElementById(textId).textContent = timeLeft;
      
      // –û–±–Ω–æ–≤–∏—Ç—å –∫—Ä—É–≥–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
      const circumference = 2 * Math.PI * 45; // r=45
      const ratio = selectedTime > 0 ? (1 - timeLeft / selectedTime) : 0;
      const offset = circumference * Math.min(Math.max(ratio, 0), 1);
      document.getElementById(progressId).style.strokeDashoffset = offset;
    }

    // –°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ (–∑–∞—É—á–∏–≤–∞–Ω–∏–µ)
    function nextWord() {
      currentWordIndex++;
      saveSession();
      
      if (currentWordIndex >= learnWords.length) {
        finishLearning();
      } else {
        showCurrentWord();
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Å —É—á—ë—Ç–æ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        startTimer();
      }
    }

    // –ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
    function togglePause() {
      isPaused = !isPaused;
      const btn = document.getElementById('pauseBtn');
      btn.innerHTML = isPaused ? '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '‚è∏Ô∏è –ü–∞—É–∑–∞';
      saveSession();
    }

    // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—É—á–∏–≤–∞–Ω–∏–µ
    function finishLearning() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      showModal('learnFinished');
    }

    // ========== –†–ï–ñ–ò–ú –ü–†–û–í–ï–†–ö–ò ==========

    // –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
    function startTest(words = null) {
      if (words) {
        learnWords = words;
      }
      
      // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫ (–≤–∞–∂–Ω–æ –¥–ª—è iOS/Android)
      unlockAudio();
      
      currentWordIndex = 0;
      learnMode = 'test';
      isPaused = false;
      forgottenWords = [];
      knownCount = 0;
      forgotCount = 0;
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏
      document.getElementById('learnInputSection').style.display = 'none';
      document.getElementById('learnModeSection').style.display = 'none';
      document.getElementById('testModeSection').style.display = 'block';
      
      showTestWord();
      startTimer();
      saveSession();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–ª–æ–≤–æ (—Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏)
    function showTestWord() {
      if (currentWordIndex >= learnWords.length) {
        finishTest();
        return;
      }
      
      const word = learnWords[currentWordIndex];
      document.getElementById('testCardArabic').textContent = word.arabic;
      document.getElementById('testCardTranslation').textContent = word.translation;
      
      // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–∞–∑–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (—Å–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥)
      resetTranslationButton();
      
      // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
      const progress = ((currentWordIndex + 1) / learnWords.length) * 100;
      document.getElementById('testProgressFill').style.width = progress + '%';
      document.getElementById('testProgressText').textContent = 
        `–ü—Ä–æ–≤–µ—Ä–∫–∞ ${currentWordIndex + 1} –∏–∑ ${learnWords.length}`;
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
      const card = document.getElementById('testWordCard');
      card.style.animation = 'none';
      card.offsetHeight;
      card.style.animation = 'fadeIn 0.4s ease';
    }

    // –ü–∞—É–∑–∞ –≤ —Ç–µ—Å—Ç–µ
    function toggleTestPause() {
      isPaused = !isPaused;
      const btn = document.getElementById('testPauseBtn');
      btn.innerHTML = isPaused ? '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '‚è∏Ô∏è –ü–∞—É–∑–∞';
      saveSession();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    function toggleTranslation() {
      const card = document.getElementById('testWordCard');
      const btn = document.getElementById('showTranslationBtn');
      
      if (card.classList.contains('word-card-hidden')) {
        card.classList.remove('word-card-hidden');
        btn.classList.add('active');
        btn.title = '–°–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥';
      } else {
        card.classList.add('word-card-hidden');
        btn.classList.remove('active');
        btn.title = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥';
      }
    }

    // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫–∞–∑–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
    function resetTranslationButton() {
      const card = document.getElementById('testWordCard');
      const btn = document.getElementById('showTranslationBtn');
      card.classList.add('word-card-hidden');
      btn.classList.remove('active');
      btn.title = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥';
    }

    // –Ø –∑–Ω–∞—é
    function markKnow() {
      knownCount++;
      nextTestWord();
    }

    // –Ø –∑–∞–±—ã–ª
    function markForgot() {
      forgotCount++;
      forgottenWords.push(learnWords[currentWordIndex]);
      nextTestWord();
    }

    // –°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞)
    function nextTestWord() {
      currentWordIndex++;
      saveSession();
      
      if (currentWordIndex >= learnWords.length) {
        finishTest();
      } else {
        showTestWord();
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
        startTimer();
      }
    }

    // –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
    function finishTest() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      showModal('testFinished');
    }

    // ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ==========

    function showModal(type) {
      const overlay = document.getElementById('modalOverlay');
      const content = document.getElementById('modalContent');
      
      let html = '';
      
      if (type === 'learnFinished') {
        html = `
          <div class="modal-icon">üéâ</div>
          <div class="modal-title">–ó–∞—É—á–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</div>
          <div class="modal-text">–í—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –≤—Å–µ ${learnWords.length} —Å–ª–æ–≤</div>
          <div class="modal-buttons">
            <button class="modal-btn modal-btn-primary" onclick="showRepeatOptions()">
              üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞—É—á–∏–≤–∞–Ω–∏–µ
            </button>
            <button class="modal-btn modal-btn-secondary" onclick="closeModalAndStartTest()">
              ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—É—á–µ–Ω–Ω–æ–µ
            </button>
            <button class="modal-btn modal-btn-danger" onclick="closeModalAndReset()">
              ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å
            </button>
          </div>
        `;
      } else if (type === 'repeatOptions') {
        html = `
          <div class="modal-icon">‚è±Ô∏è</div>
          <div class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞</div>
          <div class="modal-text">–û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç–∞–π–º–µ—Ä (${selectedTime} —Å–µ–∫) –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å?</div>
          <div class="modal-buttons">
            <button class="modal-btn modal-btn-primary" onclick="repeatWithSameTimer()">
              ‚úì –û—Å—Ç–∞–≤–∏—Ç—å ${selectedTime} —Å–µ–∫
            </button>
            <button class="modal-btn modal-btn-secondary" onclick="repeatWithNewTimer()">
              ‚öôÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä
            </button>
          </div>
        `;
      } else if (type === 'testFinished') {
        html = `
          <div class="modal-icon">üìä</div>
          <div class="modal-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</div>
          <div class="modal-stats">
            <div class="stat-item">
              <div class="stat-value green">${knownCount}</div>
              <div class="stat-label">–ó–Ω–∞—é</div>
            </div>
            <div class="stat-item">
              <div class="stat-value red">${forgotCount}</div>
              <div class="stat-label">–ó–∞–±—ã–ª</div>
            </div>
          </div>
          ${forgottenWords.length > 0 ? `
            <div class="modal-text">–ó–∞–±—ã—Ç—ã–µ —Å–ª–æ–≤–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∑–∞—É—á–∏–≤–∞–Ω–∏–µ</div>
            <div class="modal-buttons">
              <button class="modal-btn modal-btn-primary" onclick="learnForgottenWords()">
                üìö –ó–∞—É—á–∏—Ç—å –∑–∞–±—ã—Ç—ã–µ (${forgottenWords.length})
              </button>
              <button class="modal-btn modal-btn-danger" onclick="closeModalAndReset()">
                ‚ùå –ó–∞–≤–µ—Ä—à–∏—Ç—å
              </button>
            </div>
          ` : `
            <div class="modal-text">–û—Ç–ª–∏—á–Ω–æ! –í—ã –∑–Ω–∞–µ—Ç–µ –≤—Å–µ —Å–ª–æ–≤–∞!</div>
            <div class="modal-buttons">
              <button class="modal-btn modal-btn-primary" onclick="closeModalAndReset()">
                ‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å
              </button>
            </div>
          `}
        `;
      }
      
      content.innerHTML = html;
      overlay.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modalOverlay').style.display = 'none';
    }

    function showRepeatOptions() {
      showModal('repeatOptions');
    }

    function repeatWithSameTimer() {
      closeModal();
      unlockAudio();
      currentWordIndex = 0;
      learnMode = 'learn';
      document.getElementById('learnModeSection').style.display = 'block';
      document.getElementById('testModeSection').style.display = 'none';
      showCurrentWord();
      startTimer();
      saveSession();
    }

    function repeatWithNewTimer() {
      closeModal();
      // –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∞–π–º–µ—Ä–∞
      document.getElementById('learnInputSection').style.display = 'block';
      document.getElementById('learnModeSection').style.display = 'none';
      document.getElementById('testModeSection').style.display = 'none';
      // –¢–µ–∫—Å—Ç –≤ textarea —É–∂–µ –µ—Å—Ç—å
    }

    function closeModalAndStartTest() {
      closeModal();
      startTest();
    }

    function closeModalAndReset() {
      closeModal();
      clearSession();
      resetLearning();
    }

    function learnForgottenWords() {
      closeModal();
      unlockAudio();
      learnWords = [...forgottenWords];
      forgottenWords = [];
      currentWordIndex = 0;
      learnMode = 'learn';
      
      document.getElementById('learnModeSection').style.display = 'block';
      document.getElementById('testModeSection').style.display = 'none';
      
      showCurrentWord();
      startTimer();
      saveSession();
    }

    // –°–±—Ä–æ—Å –∑–∞—É—á–∏–≤–∞–Ω–∏—è
    function resetLearning() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      learnWords = [];
      currentWordIndex = 0;
      forgottenWords = [];
      knownCount = 0;
      forgotCount = 0;
      isPaused = false;
      
      document.getElementById('learnInputSection').style.display = 'block';
      document.getElementById('learnModeSection').style.display = 'none';
      document.getElementById('testModeSection').style.display = 'none';
      document.getElementById('learnTextarea').value = '';
      
      // –°–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ –ø–∞—É–∑—ã
      const pauseBtn = document.getElementById('pauseBtn');
      if (pauseBtn) pauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
      const testPauseBtn = document.getElementById('testPauseBtn');
      if (testPauseBtn) testPauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è picker –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    initPicker();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    checkSavedSession();
  </script>
</body>
</html>
