<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ - –ê—Ä–∞–±—Å–∫–∏–µ —Å–ª–æ–≤–∞</title>
  <script src="theme.js"></script>
  <link rel="stylesheet" href="theme.css">
  <script src="service-worker-register.js"></script>
  <script src="sidebar-menu.js"></script>
  <script src="favorites.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f7fa;
      color: #1f2937;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .header h1 {
      font-size: 24px;
      color: #333;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .clear-fav-btn {
      padding: 8px 10px;
      background: #fff5f5;
      color: #d14343;
      border: 1px solid #f8caca;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .clear-fav-btn:hover {
      background: #ffecec;
      box-shadow: 0 2px 8px rgba(209, 67, 67, 0.25);
    }

    .word-count {
      font-size: 14px;
      color: #6b7280;
      background: #f3f4f6;
      padding: 6px 12px;
      border-radius: 20px;
    }

    .copy-all-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .copy-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .copy-all-btn:active {
      transform: translateY(0);
    }

    /* –¢–∞–±—ã */
    .tabs {
      display: flex;
      gap: 10px;
      border-top: 1px solid #e5e7eb;
      padding-top: 15px;
    }

    .tab-btn {
      padding: 10px 20px;
      border: none;
      background: #f3f4f6;
      color: #6b7280;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-btn:hover {
      background: #e5e7eb;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .tab-badge {
      background: rgba(255,255,255,0.2);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
    }

    .tab-btn:not(.active) .tab-badge {
      background: #d1d5db;
      color: #374151;
    }

    .words-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .word-item {
      padding: 14px 20px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .word-item:hover {
      background: #f8f9ff;
    }

    .word-item:last-child {
      border-bottom: none;
    }

    .word-item.copied {
      background: #e8f5e9;
    }

    .word-text {
      flex: 1;
      font-size: 16px;
      line-height: 1.8;
      word-break: break-word;
    }

    .word-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .star-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
      opacity: 0.4;
      transition: all 0.2s;
    }

    .star-btn:hover {
      opacity: 1;
      transform: scale(1.2);
    }

    .star-btn.active {
      opacity: 1;
    }

    .copy-icon {
      opacity: 0;
      color: #667eea;
      font-size: 14px;
      padding: 4px 8px;
      transition: opacity 0.2s;
    }

    .word-item:hover .copy-icon {
      opacity: 1;
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 9999;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
      font-size: 16px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      text-align: center;
      padding: 40px 20px;
      color: #ef4444;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .empty-state p {
      font-size: 16px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 600px) {
      body {
        padding: 15px;
      }

      .header {
        padding: 15px;
      }

      .header h1 {
        font-size: 20px;
      }

      .word-item {
        padding: 12px 15px;
      }

      .word-text {
        font-size: 15px;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .tab-btn {
        flex: 1;
        justify-content: center;
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-top">
        <h1>üìã –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤</h1>
        <div class="header-info">
          <span class="word-count" id="wordCount">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          <button class="copy-all-btn" id="copyAllBtn" disabled>
            <span>üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë
          </button>
          <button class="clear-fav-btn" id="clearFavBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">üóëÔ∏è</button>
        </div>
      </div>
      <div class="tabs">
        <button class="tab-btn active" id="tabAll" onclick="showTab('all')">
          üìö –í—Å–µ —Å–ª–æ–≤–∞ <span class="tab-badge" id="allCount">0</span>
        </button>
        <button class="tab-btn" id="tabFavorites" onclick="showTab('favorites')">
          ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ <span class="tab-badge" id="favCount">0</span>
        </button>
      </div>
    </div>

    <div class="words-container" id="wordsContainer">
      <div class="loading">
        <div class="loading-spinner"></div>
        –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤...
      </div>
    </div>
  </div>

  <div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

  <script>
    let allWordsText = '';
    let allWords = [];
    let currentTab = 'all';

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (e) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        return true;
      }
    }

    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function showTab(tab) {
      currentTab = tab;
      
      document.getElementById('tabAll').classList.toggle('active', tab === 'all');
      document.getElementById('tabFavorites').classList.toggle('active', tab === 'favorites');
      
      renderWords();
      updateCounts();
    }

    // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏
    function updateCounts() {
      document.getElementById('allCount').textContent = allWords.length;
      document.getElementById('favCount').textContent = getFavoritesCount();
      
      if (currentTab === 'all') {
        document.getElementById('wordCount').textContent = `${allWords.length} —Å–ª–æ–≤`;
      } else {
        document.getElementById('wordCount').textContent = `${getFavoritesCount()} –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö`;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ª–æ–≤
    function renderWords() {
      const container = document.getElementById('wordsContainer');
      let wordsToShow = currentTab === 'all' ? allWords : getFavorites();
      
      if (wordsToShow.length === 0) {
        if (currentTab === 'favorites') {
          container.innerHTML = `
            <div class="empty-state">
              <div class="icon">‚≠ê</div>
              <p>–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤</p>
              <p style="font-size: 14px; margin-top: 8px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–≤–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–æ–≤</p>
            </div>
          `;
        } else {
          container.innerHTML = '<div class="error">–ù–µ—Ç —Å–ª–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
        }
        return;
      }

      let html = '';
      wordsToShow.forEach((line) => {
        const cleanLine = typeof line === 'string' ? line.trim() : line;
        if (cleanLine) {
          const isFav = isFavorite(cleanLine);
          html += `
            <div class="word-item" data-text="${escapeHtml(cleanLine).replace(/"/g, '&quot;')}">
              <span class="word-text">${escapeHtml(cleanLine)}</span>
              <div class="word-actions">
                <button class="star-btn ${isFav ? 'active' : ''}" onclick="toggleStar(event, this)" title="${isFav ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}">
                  ${isFav ? '‚≠ê' : '‚òÜ'}
                </button>
                <span class="copy-icon" onclick="copyWord(event, this.parentElement.parentElement)">üìã</span>
              </div>
            </div>
          `;
        }
      });

      container.innerHTML = html;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    function toggleStar(event, btn) {
      event.stopPropagation();
      const wordItem = btn.closest('.word-item');
      const text = wordItem.getAttribute('data-text');
      
      const isNowFavorite = toggleFavorite(text);
      
      btn.classList.toggle('active', isNowFavorite);
      btn.innerHTML = isNowFavorite ? '‚≠ê' : '‚òÜ';
      btn.title = isNowFavorite ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
      
      showToast(isNowFavorite ? '–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ' : '–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
      
      // –ï—Å–ª–∏ –º—ã –≤ —Ç–∞–±–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∏ —É–¥–∞–ª–∏–ª–∏ —Å–ª–æ–≤–æ - –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å
      if (currentTab === 'favorites' && !isNowFavorite) {
        setTimeout(() => renderWords(), 300);
      }
      
      updateCounts();
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–æ
    async function copyWord(event, element) {
      event.stopPropagation();
      const text = element.getAttribute('data-text');
      await copyText(text);
      
      element.classList.add('copied');
      setTimeout(() => {
        element.classList.remove('copied');
      }, 500);
      
      showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤
    async function loadWords() {
      const container = document.getElementById('wordsContainer');
      const copyAllBtn = document.getElementById('copyAllBtn');

      try {
        const response = await fetch('words.txt');
        if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        
        const text = await response.text();
        allWordsText = text;
        
        allWords = text.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));
        
        copyAllBtn.disabled = false;
        
        renderWords();
        updateCounts();

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        container.innerHTML = '<div class="error">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤</div>';
        document.getElementById('wordCount').textContent = '–û—à–∏–±–∫–∞';
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë
    document.getElementById('copyAllBtn').addEventListener('click', async () => {
      let textToCopy;
      if (currentTab === 'all') {
        textToCopy = allWordsText;
      } else {
        textToCopy = getFavoritesAsText();
      }
      
      if (textToCopy) {
        await copyText(textToCopy);
        showToast(currentTab === 'all' ? '–í–µ—Å—å —Å–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!' : '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    document.getElementById('clearFavBtn').addEventListener('click', () => {
      localStorage.removeItem('arabFavorites');
      window.dispatchEvent(new CustomEvent('favoritesChanged', { detail: { action: 'clear' } }));
      showToast('–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –æ—á–∏—â–µ–Ω–æ');
      if (currentTab === 'favorites') {
        renderWords();
      }
      updateCounts();
    });

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    window.addEventListener('favoritesChanged', () => {
      if (currentTab === 'favorites') {
        renderWords();
      }
      updateCounts();
    });

    // –ö–ª–∏–∫ –Ω–∞ —Å—Ç—Ä–æ–∫—É - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
    document.getElementById('wordsContainer').addEventListener('click', async (e) => {
      const wordItem = e.target.closest('.word-item');
      if (wordItem && !e.target.closest('.star-btn') && !e.target.closest('.copy-icon')) {
        const text = wordItem.getAttribute('data-text');
        await copyText(text);
        wordItem.classList.add('copied');
        setTimeout(() => wordItem.classList.remove('copied'), 500);
        showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
      }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadWords();
  </script>
</body>
</html>
